{"version":3,"file":"node-build.mjs","sources":["../../server/db/supabaseService.ts","../../server/routes/scrums.ts","../../server/routes/auth.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { createClient, SupabaseClient } from \"@supabase/supabase-js\";\n\n\nlet supabase: SupabaseClient | null = null;\nlet supabaseAdmin: SupabaseClient | null = null;\n\nfunction initializeClient() {\n    if (supabase && supabaseAdmin) return;\n\n    const supabaseUrl: string | undefined = process.env.SUPABASE_URL;\n    const supabaseKey: string | undefined = process.env.SUPABASE_KEY;\n    const supabaseAdminKey: string | undefined = process.env.SUPABASE_ADMIN_KEY; \n\n\n    if (!supabaseUrl || !supabaseKey || !supabaseAdminKey) {\n        throw new Error(\"âŒ Missing SUPABASE environment variables.\");\n    }\n\n    supabase = createClient(supabaseUrl, supabaseKey);\n    supabaseAdmin = createClient(supabaseUrl, supabaseAdminKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false,\n            detectSessionInUrl: false,\n        }\n    });\n}\n\n\nexport const api = {\n\n    getScrums: async () => {\n        initializeClient(); \nÂ  Â  Â  Â  const { data, error } = await supabase! \nÂ  Â  Â  Â  Â  Â  .from('scrums')\nÂ  Â  Â  Â  Â  Â  .select('*');\n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase Error fetching scrums:\", error); throw error; }\nÂ  Â  Â  Â  return data;\nÂ  Â  },\n\nÂ  Â  createScrum: async (scrumData: any) => {\n        initializeClient(); \nÂ  Â  Â  Â  const { data, error } = await supabase!\nÂ  Â  Â  Â  Â  Â  .from('scrums')\nÂ  Â  Â  Â  Â  Â  .insert([scrumData])\nÂ  Â  Â  Â  Â  Â  .select(); \n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase Error creating scrum:\", error); throw error; }\nÂ  Â  Â  Â  return data[0];\nÂ  Â  },\n\n    getUsers: async () => {\n        initializeClient();\nÂ  Â  Â  Â  const { data, error } = await supabase! \nÂ  Â  Â  Â  Â  Â  .from('users')\nÂ  Â  Â  Â  Â  Â  .select('*');\n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase Error fetching users:\", error); throw error; }\nÂ  Â  Â  Â  return data;\nÂ  Â  },\n\nÂ  Â  createUser: async (userData: any) => {\n        initializeClient();\nÂ  Â  Â  Â  const { data, error } = await supabase!\nÂ  Â  Â  Â  Â  Â  .from('users')\nÂ  Â  Â  Â  Â  Â  .insert([userData])\nÂ  Â  Â  Â  Â  Â  .select(); \n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase Error creating user:\", error); throw error; }\nÂ  Â  Â  Â  return data[0];\nÂ  Â  },\n\nÂ  Â  signUpUser: async (email: string, password: string) => {\n        initializeClient();\nÂ  Â  Â  Â  const { data, error } = await supabase!.auth.signUp({\nÂ  Â  Â  Â  Â  Â  email: email,\nÂ  Â  Â  Â  Â  Â  password: password,\nÂ  Â  Â  Â  });\n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase SignUp Error:\", error); throw error; }\nÂ  Â  Â  Â  return data;\nÂ  Â  },\n\nÂ  Â  signInUser: async (email: string, password: string) => {\n        initializeClient();\nÂ  Â  Â  Â  const { data, error } = await supabase!.auth.signInWithPassword({\nÂ  Â  Â  Â  Â  Â  email: email,\nÂ  Â  Â  Â  Â  Â  password: password,\nÂ  Â  Â  Â  });\n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase SignIn Error:\", error); throw error; }\nÂ  Â  Â  Â  return data;\nÂ  Â  },\n\nÂ  Â  getUserFromToken: async (token: string) => {\n        initializeClient();\nÂ  Â  Â  Â  const { data, error } = await supabase!.auth.getUser(token);\n\nÂ  Â  Â  Â  if (error) { console.error(\"Supabase GetUser Error:\", error); throw error; }\nÂ  Â  Â  Â  return data;\nÂ  Â  },\n\nÂ  Â  userExists: async (email: string) => {\n        initializeClient();\nÂ  Â      const { data, error } = await supabaseAdmin!.auth.admin.listUsers({\nÂ  Â  Â  Â      email: email\nÂ  Â      }as any);\n\nÂ  Â      if (error) { console.error(\"Supabase Admin listUsers error:\", error); throw error; }\n\nÂ  Â      if (data.users.length === 0) { return false; }\nÂ  Â  \nÂ  Â      const exists = data.users.some((user: { email?: string }) => user.email && user.email.toLowerCase() === email.toLowerCase());\nÂ  Â  \nÂ  Â      return exists; \n    },\n\n};","import { RequestHandler } from \"express\";\nimport { api } from \"../db/supabaseService\"; \n\n\nexport const handleGetScrums: RequestHandler = async (req, res) => {\n    try {\n        const scrums = await api.getScrums(); \n        \n        res.status(200).json({ scrums });\n    } catch (err) {\n        console.error(\"Error handling getScrums:\", err.message);\n        res.status(500).json({ error: \"Failed to retrieve scrum data.\" });\n    }\n};\n\nexport const handlePostScrum: RequestHandler = async (req, res) => {\n    try {\n        const scrumData = req.body; \n        \n        // if (!scrumData || !scrumData.id || !scrumData.name) {\n        //     return res.status(400).json({ error: \"Missing required fields for new scrum.\" });\n        // }\n        \n        const newScrum = await api.createScrum(scrumData); \n        \n        res.status(201).json(newScrum);\n        \n    } catch (err) {\n        console.error(\"Error handling postScrum:\", err.message);\n        res.status(500).json({ error: \"Failed to create new scrum.\" });\n    }\n};","import { RequestHandler } from \"express\";\nimport { api } from \"../db/supabaseService\"; \n\n\nexport const handleSignUp: RequestHandler = async (req, res) => {\n    try {\n        const { email, password } = req.body; \n\n        if (!email || !password) {\n            return res.status(400).json({ error: \"Email and password are required for sign-up.\" });\n        }\n        \n        const data = await api.signUpUser(email, password); \n        \n        if (data.user && !data.session) {\n            return res.status(202).json({ \n                message: \"Account created. Please check your email to confirm registration.\"\n            });\n        }\n\n        res.status(201).json(data);\n        \n    } catch (err) {\n        console.error(\"Error handling sign-up:\", err.message);\n        res.status(400).json({ error: err.message });\n    }\n};\n\nexport const handleSignIn: RequestHandler = async (req, res) => {\n    try {\n        const { email, password } = req.body; \n\n        if (!email || !password) {\n            return res.status(400).json({ error: \"Email and password are required for sign-in.\" });\n        }\n        \n        const data = await api.signInUser(email, password); \n        \n        if (!data.session) {\n            return res.status(401).json({ error: \"Invalid credentials or user not confirmed.\" });\n        }\n\n        res.status(200).json(data);\n        \n    } catch (err) {\n        console.error(\"Error handling sign-in:\", err.message);\n        res.status(401).json({ error: err.message }); \n    }\n};\n\nexport const handleLoginOrRegister: RequestHandler = async (req, res) => {\n    try {\n        const { email, password } = req.body; \n\n        if (!email || !password) {\n            return res.status(400).json({ error: \"Email and password are required.\" });\n        }\n\n        const userExists = await api.userExists(email);\n        let sessionData: any;\n\n        if (userExists) {\n            try {\n                sessionData = await api.signInUser(email, password);\n            } catch (e) {\n                return res.status(401).json({ error: e.message || \"Invalid credentials.\" });\n            }\n\n        } else {\n            try {\n                sessionData = await api.signUpUser(email, password);\n                \n                if (sessionData.user && !sessionData.session) {\n                    return res.status(202).json({ \n                        message: 'Account created! Please check your email to log in.',\n                        requiresConfirmation: true\n                    });\n                }\n            } catch (e) {\n                return res.status(400).json({ error: e.message || \"Registration failed.\" });\n            }\n        }\n\n        return res.status(200).json(sessionData);\n\n    } catch (err) {\n        console.error(\"FATAL Server Error in Login/Register:\", err.message);\n        res.status(500).json({ error: \"An unexpected server error occurred.\" });\n    }\n};","import * as dotenv from \"dotenv\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleGetScrums, handlePostScrum } from \"./routes/scrums.ts\"; \nimport { handleSignUp, handleSignIn, handleLoginOrRegister } from \"./routes/auth.ts\"; \n\ndotenv.config({ path: '.env.secret' });\ndotenv.config({ path: '.env.public', override: false }); \n\n\nexport function createServer() {\nÂ  Â  const app = express();\nÂ  Â  app.use(cors());\nÂ  Â  app.use(express.json()); \nÂ  Â  app.use(express.urlencoded({ extended: true }));\n\n\nÂ  Â  app.get(\"/api/scrums\", handleGetScrums);\nÂ  Â  app.post(\"/api/scrums\", handlePostScrum);\n    app.post(\"/api/auth/signup\", handleSignUp);\n    app.post(\"/api/auth/signin\", handleSignIn);\n    app.post(\"/api/auth/login-or-register\", handleLoginOrRegister);\n\nÂ  Â  return app;\n}","import path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// Get __dirname equivalent in ESM\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// In production, serve the built SPA files\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"/:path*\", (req, res) => {\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});"],"names":["app","express"],"mappings":"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"}